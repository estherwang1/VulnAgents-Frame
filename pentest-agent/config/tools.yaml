# ============================================================
# 工具定义配置 - Tool Definitions
# ============================================================
# 定义所有可用工具的元数据
# 实际实现在 tools/remote_tools.py 和 tools/local_tools.py

# ============================================================
# 远程工具（通过 MCP 服务器执行）
# ============================================================
remote_tools:

  # === 任务戳管理 ===
  generate_stamp:
    description: "生成新的任务戳，用于追踪整个渗透测试任务的生命周期"
    category: "stamp"
    parameters:
      - name: mission_name
        type: string
        required: true
        description: "任务名称"
      - name: target
        type: string
        required: true
        description: "目标IP或域名"
      - name: operator
        type: string
        required: false
        default: "shadow_commander"
        description: "操作者名称"
      - name: tags
        type: list
        required: false
        description: "任务标签列表"

  get_stamp_info:
    description: "获取任务戳的详细信息，包括关联的任务、发现的漏洞等"
    category: "stamp"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID，格式：SHADOW-YYYYMMDD-HHMMSS-XXXX"

  list_stamps:
    description: "列出所有活跃的任务戳"
    category: "stamp"
    parameters: []

  add_finding:
    description: "记录发现的漏洞到任务戳"
    category: "stamp"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"
      - name: vuln_type
        type: string
        required: true
        description: "漏洞类型，如 SQLi、XSS、IDOR、RCE 等"
      - name: severity
        type: string
        required: true
        enum: ["critical", "high", "medium", "low", "info"]
        description: "严重程度"
      - name: description
        type: string
        required: true
        description: "漏洞详细描述"
      - name: evidence
        type: object
        required: false
        description: "证据数据"

  update_stamp_status:
    description: "更新任务戳状态"
    category: "stamp"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"
      - name: status
        type: string
        required: true
        enum: ["active", "completed", "failed", "paused"]
        description: "状态"
      - name: notes
        type: string
        required: false
        description: "状态备注"

  # === 任务执行 ===
  deploy_and_run_task:
    description: "部署脚本到远程MCP服务器并执行。代理生成脚本内容后调用此工具上传并运行"
    category: "task"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"
      - name: script_name
        type: string
        required: true
        description: "脚本文件名，如 port_scan.py"
      - name: script_content
        type: string
        required: true
        description: "完整的脚本内容"

  get_task_status:
    description: "获取任务执行状态"
    category: "task"
    parameters:
      - name: stamp
        type: string
        required: false
        description: "任务戳ID（不填返回所有任务）"
      - name: task_id
        type: string
        required: false
        description: "任务ID"

  get_task_result:
    description: "获取任务执行结果（日志内容）"
    category: "task"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"
      - name: task_id
        type: string
        required: true
        description: "任务ID"
      - name: tail_lines
        type: integer
        required: false
        default: 50
        description: "读取最后N行日志"

  cancel_task:
    description: "取消正在运行的任务"
    category: "task"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"
      - name: task_id
        type: string
        required: true
        description: "任务ID"

  # === 文件操作 ===
  list_workspace_files:
    description: "列出任务戳工作空间中的所有文件"
    category: "file"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"

  read_workspace_file:
    description: "读取工作空间中的文件内容"
    category: "file"
    parameters:
      - name: stamp
        type: string
        required: true
        description: "任务戳ID"
      - name: filename
        type: string
        required: true
        description: "文件名"
      - name: max_lines
        type: integer
        required: false
        default: 100
        description: "最大读取行数"

# ============================================================
# 本地工具（在 LangGraph 环境执行）
# ============================================================
local_tools:

  write_local_file:
    description: "在本地工作空间写入文件"
    category: "local"
    parameters:
      - name: filepath
        type: string
        required: true
        description: "文件路径（相对于工作空间）"
      - name: content
        type: string
        required: true
        description: "文件内容"
      - name: append
        type: boolean
        required: false
        default: false
        description: "是否追加模式"

  read_local_file:
    description: "读取本地工作空间的文件"
    category: "local"
    parameters:
      - name: filepath
        type: string
        required: true
        description: "文件路径（相对于工作空间）"

  update_mission_log:
    description: "更新任务账本（mission.md）"
    category: "local"
    parameters:
      - name: content
        type: string
        required: true
        description: "要写入的内容"
      - name: append
        type: boolean
        required: false
        default: true
        description: "是否追加模式"

# ============================================================
# 工具集分组（供代理使用）
# ============================================================
tool_groups:

  # 主代理工具集
  main_agent:
    - generate_stamp
    - get_stamp_info
    - list_stamps
    - update_stamp_status
    - get_task_status
    - update_mission_log

  # 子代理通用工具集
  subagent_common:
    - deploy_and_run_task
    - get_task_status
    - get_task_result
    - add_finding
    - list_workspace_files
    - read_workspace_file

  # 侦察专家额外工具
  reconnaissance:
    - generate_stamp  # 可以生成任务戳

  # 知识库专家额外工具
  knowledge:
    - read_local_file
