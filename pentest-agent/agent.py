# -*- coding: utf-8 -*-
"""
Main Agent (Shadow Commander)
主代理 - 全局战略指挥官
"""

import os
from dotenv import load_dotenv

load_dotenv()

from langgraph.prebuilt import create_react_agent

from core.config_loader import load_prompt, config_loader
from agents.base_agent import create_model
from tools import MAIN_AGENT_TOOLS
from tools.local_tools import MAIN_AGENT_LOCAL_TOOLS


def create_main_agent():
    """
    创建主代理（Shadow Commander）
    """
    # 验证必要环境变量
    required_vars = ["ANTHROPIC_API_KEY", "MCP_KEY"]
    missing_vars = [var for var in required_vars if not os.getenv(var)]
    
    if missing_vars:
        raise EnvironmentError(
            f"缺少环境变量: {', '.join(missing_vars)}\n"
            f"请在 .env 文件中设置"
        )
    
    system_prompt = load_prompt("main_agent")
    model = create_model()
    all_tools = MAIN_AGENT_TOOLS + MAIN_AGENT_LOCAL_TOOLS
    
    return create_react_agent(
        model=model,
        tools=all_tools,
        prompt=system_prompt
    )


graph = create_main_agent()


if __name__ == "__main__":
    config_loader.print_config()
    print("✅ 主代理已准备就绪！")
